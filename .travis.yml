language: r
dist: xenial
latex: false

branches:
  only:
  - master

cache:
  packages: yes

directories:
  - $HOME/bin

script:
- curl -L https://julialang-s3.julialang.org/bin/linux/x64/1.5/julia-1.5-latest-linux-x86_64.tar.gz -o "$HOME/Downloads/julia.tar.gz"
- tar xzf "$HOME/Downloads/julia.tar.gz" -C "$HOME/Downloads"
- cp -r "$(find "$HOME/Downloads" -maxdepth 2 -name "julia*" -type d | head -n 1)" "$HOME/julia"
- rm -rf ~/Downloads/julia*
- export PATH="$HOME/julia/bin:$PATH"
- export R_LD_LIBRARY_PATH="$(R RHOME)/lib:$HOME/julia/lib/julia"
- Rscript -e 'install.packages(c("devtools","blogdown","JuliaCall","aqp","soilDB","sharpshootR"))'
- Rscript -e 'devtools::install_github(c("ncss-tech/aqp", "ncss-tech/soilDB", "ncss-tech/sharpshootR"), dependencies=FALSE)'
- Rscript -e 'blogdown::install_hugo()'
- Rscript -e 'blogdown::build_site()'

deploy:
  provider: pages
  skip_cleanup: TRUE
  github_token: GITHUB_TOKEN
  keep_history: TRUE
  on:
    branch: master
  local_dir: public
  repo: brownag/brownag.github.io
  target_branch: master
  verbose: TRUE
  deployment_file: TRUE
